InnoDB는 SQL문 `SAVEPOINT`, `ROLLBACK TO SAVEPOINT`, `RELEASE SAVEPOINT` 및 `ROLLBACK`에 대한 선택적 WORK 키워드를 지원한다.

`SAVEPOINT`

- 이름이 식별자여서 이름이 지정된 트랜잭션 세이브 포인트를 설정한다.
- 현재 트랜잭션에 이름이 같은 저장점(savepoint)가 있으면 이전 저장점이 삭제되고 새 세이브포인트가 설정된다.

`ROLLBACK TO SAVEPOINT`

- 트랜잭션을 종료하지 않고 트랜잭션을 이름이 지정된 세이브포인트로 롤백한다.
- 세이브포인트가 설정된 후 행에 수행된 현재 트랜잭션의 수정은 롤백에서 취소되지만 InnoDB는 세이브 포인트 이후에 메모리에 저장된 행 잠금을 해제하지 않는다.
- 새로 삽입된 행의 경우 잠금 정보는 행에 저장된 트랜잭션 ID에 의해 전달되며 잠금은 메모리에 별도로 저장되지 않는다. 이경ㅇ ㅜ행 잠금은 실행 취소 상태에서 해제된다.
- 이름이 있는 세이브포인트보다 나중에 삭제된다.

```sql
ERROR 1305 (42000): SAVEPOINT identifier does not exist
```

- 위와 같은 오류를 리턴하면 지정된 이름의 세이브 포인트가 존재하지 않음을 의미한다.

`RELEASE SAVEPOINT`

- 현재 트랜잭션의 저장점 세트에서 이름이 지정된 저장점을 제거한다.
- 커밋 또는 롤백이 발생하지 않으며 세이브 포인트가 존재하지 않으면 오류다.

**공통사항**

- COMMIT 또는 저장점 이름을 지정하지 않는 ROLLBACK을 실행하면 현재 트랜잭션의 모든 세이브 포인트가 삭제된다.
- 저장된 기능이 호출되거나 트리거가 활성화되면 새 세이브 포인트 레벨이 작성된다. 이전 레벨의 세이브포인트를 사용할 수 없게되므로 새 레벨의 세이브포인트와 충돌하지 않는다. 기능 또는 트리거가 종료되면 작성된 세이브포인트가 해제되고 이전 세이브포인트 레벨이 복원된다.

[관련 포스트](myinfrabox.tistory.com/106?category=840483)
